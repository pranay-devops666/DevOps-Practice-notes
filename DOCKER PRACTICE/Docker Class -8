DOCKER VOLUMES 

https://docker77.hashnode.dev/docker-volumes-with-real-time-examples

DOCKER VOLUME COMMANDS

docker volume create volumename -----------> to create a volume
docker volume inspect volumename -----------> to know full information about the volume
docker volume ls                 -----------> to know the list of volumes
docker volume rm volumename      -----------> to delete the volume
docker volume prune              -----------> to delete the unused volumes




1. The main purpose of using DOCKER VOLUMES is to save the data even the containers got deleted also, again we can create new containers and use it by attaching 
the containers to the volumes.

2. we are using the component here to svae the dat is DOCKER VOLUMES even the  containers got deleted also.

3. For example same application is running in 2 containers client want to change font colour/ font size in container the change will happen in container 1 then 
what about container 2 in here container2 also need to change manually in here having 2 containers means we can do change manually
for suppose having a plenty of containers in real time we can't do manually in each container it can take more time
in this kind of case situation if we have any no.of containers also for example having plenty of application containers
here i will create one ebs volume for all this plenty of application containers and i will do attach to every conatiner
NOW once i done attached the volume to all application containers here if i update an data in volume means data will be updated in the rest of all the containers 
as well in each and every container.

4. if we add data in volume or delete the data in volume same will happen in rest of the containers as well.

5. Now can we do in pratctical
process is data will be replicated container to container lets prove it 

>.first create one volume here command was

docker volume create pranayvolume

next while going to create a container 
now we need  do mount in one particular path inside a cotainer through this create volume means data need to be store din a specific folder called as mount need 
to be mention
for example /path/----> this path not exist inside a container also it will be created as that path

now if i create a file in volume means the file must be exist in that path inside a container & in that file if we added data in volume means 
the data will be added in that file as well


i can be mount this volume to any newly create container as well

here mount means attaching a volume to a device 

now if the containers will be deleted the dat will be get in the volume

we can't attach a volume to the existing container

launch one instance--->t3.micro-->keypair----->jensecgrp------>ebs volume ---->20

docker volume ls
docker volume create pranaydb
docker volume ls

now the created volume need to be mount a new container while creating a container

docker run -itd --name cont1 --mount src=/pranaydb,destination=/babu ubuntu
# cont1----> container name praaydb-----> volume name babu------>going to mount in this path inside a container

docker exec -it cont1 bash
in here inside a container this mount point path /babu will be apper as like a directory, but it is diffirent
here inside a container /babu folder and pranaydb will both same apper like a directory but, both are differen
/babu-------> is a folder
pranaydb-------> is a volume name------> it is used to replicate the data


cd pranaydb/

add some files here 

touch file{1..5}.txt

1. first i created a volume name as pranaydb and it has empty volume data is not exist
2. next i am going to attach a new container and one particular path inside a container like /babu
3. next i created some files inside a volume those all files will get stored on this volume

ctrl+p+q

now the doubt is how do we know for a particular container which volume is attached and data where it s stored in the volume is
go to this path
cd /var/lib/docker/volume/

here we can see created volume go to that volume

cd pranaydb/
here _data folder will be appear
go to this _data folder
cd _data/
here we can see the files, folders and data inside a volume

docker default path is

cd /var/lib/docker/


if we do any changes in inside a volume like adding, deleting, updating what ever everything 
it will be happen replication in inside a container as default what we done mount pointinside a container
this is called data replication

now lets create another 2 containers to do data replication 
container to container
container------>container

docker run -itd --name cont2 --mount src=/pranaydb,destination=/babu ubuntu
docker run -itd --name cont3 --mount src=/pranaydb,destination=/babu ubuntu

now go to container1 and do some changes here

docker exec -it cont1 bash

add some files here

touch tcs infosys wipro

ctrl+p+q

now go to container 2 and add some files over there

docker exec -it cont2 bash

touch file1  file2 file3

ctrl+p+q

now go to cont and do check here data has been replicated or not what changes made in cont2

now we will do ine real time example

remove all containers

docker rm $(docker ps-a -q)

first create one volume here

docker create ramavolume

now we will keep the data inside a volume then go to volume default path

cd /var/lib/docker/volumes/

here we can see created ramavolume go to that volume

cd ramavolume/

here _data folder will be appear go to that path

cd _data

here we can add the data 

vim index.html

<h1>this is data </h1>

:wq


now create one new container and mount this volume to that new container

now here we have ramavolume and some data also is there in that volume 
suppose if we can able to do copy the data which exist in the volume into the nginx default path we can able to access the application means we need to mount the 
volume data to the nginx default path here below command

docker run -itd --name continer -p 1111:80 --mount src=/ramavolum,destination=/usr/share/nginx/html nginx

check the application will be able to access or not

publicIP:container port number

ip:1111

docker run -itd --name continer2 -p 2222:80 --mount src=/ramavolum,destination=/usr/share/nginx/html nginx

docker run -itd --name continer3 -p 3333:80 --mount src=/ramavolum,destination=/usr/share/nginx/html nginx

we are able to access the application with both containers

now if the client say made changes in application means 

we simply go to this this path made changes here

cd /var/lib/docker/volumes/

cd volumes/
cd ramavolume/
cd _data/
vim index.html
<h1>this is data </h1>
<h2>this is version-2 </h2>

:wq

here if we done made changes inside a volume means the changes will also done in all the containers as well


as of now first we created the volume and do attached the volume to a container

now we will do both at a time 
while creating the container we can able to define the volume as well like below

docker run -itd --name cont4 -p 4444:80 -v newapp:/usr/local/apache2/htdocs/ httpd

# cont4-------> container name, -v -------> menas volume, newapp--------->volume name, /usr/local/apache2/htdocs/------->httpd default path and thhis path we are
going to do mount,   httpd-------> base image

cd /var/lib/docker/volumes/newapp/_data/

vim index.html

<h1>this is data </h1>

:wq

do check we can able to access the application or not

IP:container port number

docker volume inspect newapp
# if we want to get the full information of the volume


as of now we done data replication 
container to container


now we will do host to container
host means ec2-instance where the docker has installed

for example i have a folder in my ec2-instance means if i create a file here means the file must be go to a container this is host to container and
if i create a file in container means need to get the file in host as well

lets doin practical way by taking one git repo

yum install git -y

git clone url

git checkout master

cd codefolder/

now i have to move all here existing fies to a container like host to container concept
while doing this host to container concept volumes can't be created anywhere

docker run -itd --name prany -p 1111:80 -v $(pwd):/usr/share/nginx/html nginx
# pranay--->container name, -v -------> volume, $(pwd)-------> present working directory, /usr/share/nginx/html------>nginx default path

publicIP:1111

able to access application

incase in here files got deleted in host means data will be get deleted in a container as well So, this will be can't used in real times

most preferred thing in real time is create a volume and attach a continer to it

now for example we created a one volume and attached the volume to a container and done mount as well

for suppose if someone deleted the data in a container means the data will be get deleted in volume as well
this is major drawback
in this cases we will use read only permissions mounting to a container concept
means for mount point inside a container we will set read only acess like below

docker run -itd --name container --mount src=babu,destination=/gorantla:ro ubuntu
docker run -itd --name container --mount -v volumename:/myapp:ro ubuntu
#cont7------> container name, babu----> volume name, /gorantla,ro------> mount point inside a container with read only access

docker run -itd --name prany -p 1111:80 -v volumename:/usr/share/nginx/html nginx
# this is the command to create a container and defining volume as well


docker run -itd --name container --mount src=babu,destination=/gorantla,ro ubuntu----------> this will work

we need to use , for a existing volume for giving read only permission access to a container here
for newly createing we can use : for giving read only permission access to a container here
   
